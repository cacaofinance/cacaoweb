{"ast":null,"code":"import { getPointCenterIfoContract } from 'utils/contractHelpers';\nimport ifosList from 'config/constants/ifo';\nimport { campaignMap } from 'config/constants/campaigns';\nimport makeBatchRequest from './makeBatchRequest';\nexport const getAchievementTitle = campaign => {\n  switch (campaign.type) {\n    case 'ifo':\n      return {\n        id: 999,\n        fallback: `IFO Shopper: ${campaign.title}`,\n        data: {\n          name: campaign.title\n        }\n      };\n\n    default:\n      return campaign.title;\n  }\n};\nexport const getAchievementDescription = campaign => {\n  switch (campaign.type) {\n    case 'ifo':\n      return {\n        id: 999,\n        fallback: `Committed more than $5 worth of LP in the ${campaign.title} IFO`,\n        data: {\n          name: campaign.title\n        }\n      };\n\n    default:\n      return campaign.description;\n  }\n};\n/**\r\n * Checks if a wallet is eligble to claim points from valid IFO's\r\n */\n\nexport const getClaimableIfoData = async account => {\n  const ifoCampaigns = ifosList.filter(ifoItem => ifoItem.campaignId !== undefined);\n  const ifoCampaignAddresses = ifoCampaigns.map(ifoItem => ifoItem.address);\n  const pointCenterContract = getPointCenterIfoContract(); // Returns the claim status of every IFO with a campaign ID\n\n  const claimStatuses = await pointCenterContract.methods.checkClaimStatuses(account, ifoCampaignAddresses).call(); // Get IFO data for all IFO's that are eligible to claim\n\n  const claimableIfoData = await makeBatchRequest(claimStatuses.reduce((accum, claimStatus, index) => {\n    if (claimStatus === true) {\n      return [...accum, pointCenterContract.methods.ifos(ifoCampaignAddresses[index]).call];\n    }\n\n    return accum;\n  }, [])); // Transform response to an Achievement\n\n  return claimableIfoData.reduce((accum, claimableIfoDataItem) => {\n    if (!campaignMap.has(claimableIfoDataItem.campaignId)) {\n      return accum;\n    }\n\n    const campaignMeta = campaignMap.get(claimableIfoDataItem.campaignId);\n    const {\n      address\n    } = ifoCampaigns.find(ifoCampaign => ifoCampaign.campaignId === claimableIfoDataItem.campaignId);\n    return [...accum, {\n      address,\n      id: claimableIfoDataItem.campaignId,\n      type: 'ifo',\n      title: getAchievementTitle(campaignMeta),\n      description: getAchievementDescription(campaignMeta),\n      badge: campaignMeta.badge,\n      points: Number(claimableIfoDataItem.numberPoints)\n    }];\n  }, []);\n};","map":{"version":3,"sources":["C:/PROYECTOS/SVY/svy final/Sviolence-frontend/src/utils/achievements.ts"],"names":["getPointCenterIfoContract","ifosList","campaignMap","makeBatchRequest","getAchievementTitle","campaign","type","id","fallback","title","data","name","getAchievementDescription","description","getClaimableIfoData","account","ifoCampaigns","filter","ifoItem","campaignId","undefined","ifoCampaignAddresses","map","address","pointCenterContract","claimStatuses","methods","checkClaimStatuses","call","claimableIfoData","reduce","accum","claimStatus","index","ifos","claimableIfoDataItem","has","campaignMeta","get","find","ifoCampaign","badge","points","Number","numberPoints"],"mappings":"AACA,SAASA,yBAAT,QAA0C,uBAA1C;AACA,OAAOC,QAAP,MAAqB,sBAArB;AACA,SAASC,WAAT,QAA4B,4BAA5B;AAEA,OAAOC,gBAAP,MAA6B,oBAA7B;AAQA,OAAO,MAAMC,mBAAmB,GAAIC,QAAD,IAA0C;AAC3E,UAAQA,QAAQ,CAACC,IAAjB;AACE,SAAK,KAAL;AACE,aAAO;AACLC,QAAAA,EAAE,EAAE,GADC;AAELC,QAAAA,QAAQ,EAAG,gBAAeH,QAAQ,CAACI,KAAM,EAFpC;AAGLC,QAAAA,IAAI,EAAE;AACJC,UAAAA,IAAI,EAAEN,QAAQ,CAACI;AADX;AAHD,OAAP;;AAOF;AACE,aAAOJ,QAAQ,CAACI,KAAhB;AAVJ;AAYD,CAbM;AAeP,OAAO,MAAMG,yBAAyB,GAAIP,QAAD,IAA0C;AACjF,UAAQA,QAAQ,CAACC,IAAjB;AACE,SAAK,KAAL;AACE,aAAO;AACLC,QAAAA,EAAE,EAAE,GADC;AAELC,QAAAA,QAAQ,EAAG,6CAA4CH,QAAQ,CAACI,KAAM,MAFjE;AAGLC,QAAAA,IAAI,EAAE;AACJC,UAAAA,IAAI,EAAEN,QAAQ,CAACI;AADX;AAHD,OAAP;;AAOF;AACE,aAAOJ,QAAQ,CAACQ,WAAhB;AAVJ;AAYD,CAbM;AAeP;AACA;AACA;;AACA,OAAO,MAAMC,mBAAmB,GAAG,MAAOC,OAAP,IAAmD;AACpF,QAAMC,YAAY,GAAGf,QAAQ,CAACgB,MAAT,CAAiBC,OAAD,IAAaA,OAAO,CAACC,UAAR,KAAuBC,SAApD,CAArB;AACA,QAAMC,oBAAoB,GAAGL,YAAY,CAACM,GAAb,CAAkBJ,OAAD,IAAaA,OAAO,CAACK,OAAtC,CAA7B;AACA,QAAMC,mBAAmB,GAAGxB,yBAAyB,EAArD,CAHoF,CAKpF;;AACA,QAAMyB,aAAa,GAAI,MAAMD,mBAAmB,CAACE,OAApB,CAC1BC,kBAD0B,CACPZ,OADO,EACEM,oBADF,EAE1BO,IAF0B,EAA7B,CANoF,CAUpF;;AACA,QAAMC,gBAAgB,GAAI,MAAM1B,gBAAgB,CAC9CsB,aAAa,CAACK,MAAd,CAAqB,CAACC,KAAD,EAAQC,WAAR,EAAqBC,KAArB,KAA+B;AAClD,QAAID,WAAW,KAAK,IAApB,EAA0B;AACxB,aAAO,CAAC,GAAGD,KAAJ,EAAWP,mBAAmB,CAACE,OAApB,CAA4BQ,IAA5B,CAAiCb,oBAAoB,CAACY,KAAD,CAArD,EAA8DL,IAAzE,CAAP;AACD;;AAED,WAAOG,KAAP;AACD,GAND,EAMG,EANH,CAD8C,CAAhD,CAXoF,CAqBpF;;AACA,SAAOF,gBAAgB,CAACC,MAAjB,CAAwB,CAACC,KAAD,EAAQI,oBAAR,KAAiC;AAC9D,QAAI,CAACjC,WAAW,CAACkC,GAAZ,CAAgBD,oBAAoB,CAAChB,UAArC,CAAL,EAAuD;AACrD,aAAOY,KAAP;AACD;;AAED,UAAMM,YAAY,GAAGnC,WAAW,CAACoC,GAAZ,CAAgBH,oBAAoB,CAAChB,UAArC,CAArB;AACA,UAAM;AAAEI,MAAAA;AAAF,QAAcP,YAAY,CAACuB,IAAb,CAAmBC,WAAD,IAAiBA,WAAW,CAACrB,UAAZ,KAA2BgB,oBAAoB,CAAChB,UAAnF,CAApB;AAEA,WAAO,CACL,GAAGY,KADE,EAEL;AACER,MAAAA,OADF;AAEEhB,MAAAA,EAAE,EAAE4B,oBAAoB,CAAChB,UAF3B;AAGEb,MAAAA,IAAI,EAAE,KAHR;AAIEG,MAAAA,KAAK,EAAEL,mBAAmB,CAACiC,YAAD,CAJ5B;AAKExB,MAAAA,WAAW,EAAED,yBAAyB,CAACyB,YAAD,CALxC;AAMEI,MAAAA,KAAK,EAAEJ,YAAY,CAACI,KANtB;AAOEC,MAAAA,MAAM,EAAEC,MAAM,CAACR,oBAAoB,CAACS,YAAtB;AAPhB,KAFK,CAAP;AAYD,GApBM,EAoBJ,EApBI,CAAP;AAqBD,CA3CM","sourcesContent":["import { Campaign } from 'config/constants/types'\r\nimport { getPointCenterIfoContract } from 'utils/contractHelpers'\r\nimport ifosList from 'config/constants/ifo'\r\nimport { campaignMap } from 'config/constants/campaigns'\r\nimport { Achievement, TranslatableText } from 'state/types'\r\nimport makeBatchRequest from './makeBatchRequest'\r\n\r\ninterface IfoMapResponse {\r\n  thresholdToClaim: string\r\n  campaignId: string\r\n  numberPoints: string\r\n}\r\n\r\nexport const getAchievementTitle = (campaign: Campaign): TranslatableText => {\r\n  switch (campaign.type) {\r\n    case 'ifo':\r\n      return {\r\n        id: 999,\r\n        fallback: `IFO Shopper: ${campaign.title}`,\r\n        data: {\r\n          name: campaign.title as string,\r\n        },\r\n      }\r\n    default:\r\n      return campaign.title\r\n  }\r\n}\r\n\r\nexport const getAchievementDescription = (campaign: Campaign): TranslatableText => {\r\n  switch (campaign.type) {\r\n    case 'ifo':\r\n      return {\r\n        id: 999,\r\n        fallback: `Committed more than $5 worth of LP in the ${campaign.title} IFO`,\r\n        data: {\r\n          name: campaign.title as string,\r\n        },\r\n      }\r\n    default:\r\n      return campaign.description\r\n  }\r\n}\r\n\r\n/**\r\n * Checks if a wallet is eligble to claim points from valid IFO's\r\n */\r\nexport const getClaimableIfoData = async (account: string): Promise<Achievement[]> => {\r\n  const ifoCampaigns = ifosList.filter((ifoItem) => ifoItem.campaignId !== undefined)\r\n  const ifoCampaignAddresses = ifoCampaigns.map((ifoItem) => ifoItem.address)\r\n  const pointCenterContract = getPointCenterIfoContract()\r\n\r\n  // Returns the claim status of every IFO with a campaign ID\r\n  const claimStatuses = (await pointCenterContract.methods\r\n    .checkClaimStatuses(account, ifoCampaignAddresses)\r\n    .call()) as boolean[]\r\n\r\n  // Get IFO data for all IFO's that are eligible to claim\r\n  const claimableIfoData = (await makeBatchRequest(\r\n    claimStatuses.reduce((accum, claimStatus, index) => {\r\n      if (claimStatus === true) {\r\n        return [...accum, pointCenterContract.methods.ifos(ifoCampaignAddresses[index]).call]\r\n      }\r\n\r\n      return accum\r\n    }, []),\r\n  )) as IfoMapResponse[]\r\n\r\n  // Transform response to an Achievement\r\n  return claimableIfoData.reduce((accum, claimableIfoDataItem) => {\r\n    if (!campaignMap.has(claimableIfoDataItem.campaignId)) {\r\n      return accum\r\n    }\r\n\r\n    const campaignMeta = campaignMap.get(claimableIfoDataItem.campaignId)\r\n    const { address } = ifoCampaigns.find((ifoCampaign) => ifoCampaign.campaignId === claimableIfoDataItem.campaignId)\r\n\r\n    return [\r\n      ...accum,\r\n      {\r\n        address,\r\n        id: claimableIfoDataItem.campaignId,\r\n        type: 'ifo',\r\n        title: getAchievementTitle(campaignMeta),\r\n        description: getAchievementDescription(campaignMeta),\r\n        badge: campaignMeta.badge,\r\n        points: Number(claimableIfoDataItem.numberPoints),\r\n      },\r\n    ]\r\n  }, [])\r\n}\r\n"]},"metadata":{},"sourceType":"module"}