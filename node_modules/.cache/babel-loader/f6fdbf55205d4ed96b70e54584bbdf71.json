{"ast":null,"code":"import _objectSpread from\"C:/Users/Matias/Downloads/svy final/SPreace-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:/Users/Matias/Downloads/svy final/SPreace-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"C:/Users/Matias/Downloads/svy final/SPreace-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2;import React,{useEffect,useCallback,useState}from'react';import{Route,useRouteMatch,useLocation}from'react-router-dom';import{useDispatch}from'react-redux';import BigNumber from'bignumber.js';import{useWeb3React}from'@web3-react/core';import{Image,Heading}from'@pancakeswap-libs/uikit';import styled from'styled-components';import{BLOCKS_PER_YEAR,CAKE_PER_BLOCK,CAKE_POOL_PID}from'config';import FlexLayout from'components/layout/Flex';import Page from'components/layout/Page';import{useFarms,usePriceBnbBusd,usePriceCakeBusd,usePriceEthBusd}from'state/hooks';import useRefresh from'hooks/useRefresh';import{fetchFarmUserDataAsync}from'state/actions';import{QuoteToken}from'config/constants/types';import useI18n from'hooks/useI18n';import{orderBy}from'lodash';import FarmCard from'./components/FarmCard/FarmCard';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var StyledImage=styled(Image)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  margin-left: auto;\\n  margin-right: auto;\\n  margin-top: 58px;\\n\"])));var Header=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  padding: 32px 0px;\\n  background: \",\";\\n\\n  padding-left: 16px;\\n  padding-right: 16px;\\n\\n  \",\" {\\n    padding-left: 24px;\\n    padding-right: 24px;\\n  }\\n\"])),function(_ref){var theme=_ref.theme;return theme.colors.gradients.bubblegum;},function(_ref2){var theme=_ref2.theme;return theme.mediaQueries.sm;});var Farms=function Farms(){var _useRouteMatch=useRouteMatch(),path=_useRouteMatch.path;var _useLocation=useLocation(),pathname=_useLocation.pathname;var TranslateString=useI18n();var farmsLP=useFarms();var cakePrice=usePriceCakeBusd();var bnbPrice=usePriceBnbBusd();var _useState=useState(''),_useState2=_slicedToArray(_useState,1),query=_useState2[0];var ethPriceUsd=usePriceEthBusd();var _useWeb3React=useWeb3React(),account=_useWeb3React.account;var _useState3=useState('hot'),_useState4=_slicedToArray(_useState3,1),sortOption=_useState4[0];var dispatch=useDispatch();var _useRefresh=useRefresh(),fastRefresh=_useRefresh.fastRefresh;useEffect(function(){if(account){dispatch(fetchFarmUserDataAsync(account));}},[account,dispatch,fastRefresh]);var _useState5=useState(false),_useState6=_slicedToArray(_useState5,1),stackedOnly=_useState6[0];var activeFarms=farmsLP.filter(function(farm){return farm.pid!==0&&farm.multiplier!=='0X';});var inactiveFarms=farmsLP.filter(function(farm){return farm.pid!==0&&farm.multiplier==='0X';});var stackedOnlyFarms=activeFarms.filter(function(farm){return farm.userData&&new BigNumber(farm.userData.stakedBalance).isGreaterThan(0);});var sortFarms=function sortFarms(farms){switch(sortOption){case'apr':return orderBy(farms,'apy','desc');case'multiplier':return orderBy(farms,function(farm){return Number(farm.multiplier.slice(0,-1));},'desc');case'earned':return orderBy(farms,function(farm){return farm.userData?farm.userData.earnings:0;},'desc');case'liquidity':return orderBy(farms,function(farm){return Number(farm.liquidity);},'desc');default:return farms;}};// /!\\ This function will be removed soon\n// This function compute the APY for each farm and will be replaced when we have a reliable API\n// to retrieve assets prices against USD\nvar farmsList=useCallback(function(farmsToDisplay){var _farmsLP$find;var cakePriceVsBNB=new BigNumber(((_farmsLP$find=farmsLP.find(function(farm){return farm.pid===CAKE_POOL_PID;}))===null||_farmsLP$find===void 0?void 0:_farmsLP$find.tokenPriceVsQuote)||0);var farmsToDisplayWithAPY=farmsToDisplay.map(function(farm){if(!farm.tokenAmount||!farm.lpTotalInQuoteToken){return farm;}var cakeRewardPerBlock=CAKE_PER_BLOCK.times(farm.poolWeight);var cakeRewardPerYear=cakeRewardPerBlock.times(BLOCKS_PER_YEAR);// cakePriceInQuote * cakeRewardPerYear / lpTotalInQuoteToken\nvar apy=cakePriceVsBNB.times(cakeRewardPerYear).div(farm.lpTotalInQuoteToken);if(farm.quoteTokenSymbol===QuoteToken.BUSD||farm.quoteTokenSymbol===QuoteToken.UST){apy=cakePriceVsBNB.times(cakeRewardPerYear).div(farm.lpTotalInQuoteToken).times(bnbPrice);}else if(farm.quoteTokenSymbol===QuoteToken.ETH){apy=cakePrice.div(ethPriceUsd).times(cakeRewardPerYear).div(farm.lpTotalInQuoteToken);}else if(farm.quoteTokenSymbol===QuoteToken.CAKE){apy=cakeRewardPerYear.div(farm.lpTotalInQuoteToken);}else if(farm.dual){var cakeApy=farm&&cakePriceVsBNB.times(cakeRewardPerBlock).times(BLOCKS_PER_YEAR).div(farm.lpTotalInQuoteToken);var dualApy=farm.tokenPriceVsQuote&&new BigNumber(farm.tokenPriceVsQuote).times(farm.dual.rewardPerBlock).times(BLOCKS_PER_YEAR).div(farm.lpTotalInQuoteToken);apy=cakeApy&&dualApy&&cakeApy.plus(dualApy);}var liquidity=farm.lpTotalInQuoteToken;if(!farm.lpTotalInQuoteToken){liquidity=null;}if(farm.quoteTokenSymbol===QuoteToken.BNB){liquidity=bnbPrice.times(farm.lpTotalInQuoteToken);}if(farm.quoteTokenSymbol===QuoteToken.CAKE){liquidity=cakePrice.times(farm.lpTotalInQuoteToken);}if(farm.quoteTokenSymbol===QuoteToken.ETH){liquidity=ethPriceUsd.times(farm.lpTotalInQuoteToken);}return _objectSpread(_objectSpread({},farm),{},{apy:apy,liquidity:liquidity});});if(query){var lowercaseQuery=query.toLowerCase();farmsToDisplayWithAPY=farmsToDisplayWithAPY.filter(function(farm){if(farm.lpSymbol.toLowerCase().includes(lowercaseQuery)){return true;}return false;});}return farmsToDisplayWithAPY;},[bnbPrice,farmsLP,query,cakePrice,ethPriceUsd]);var isActive=!pathname.includes('history');var farmsStaked=[];if(isActive){farmsStaked=stackedOnly?farmsList(stackedOnlyFarms):farmsList(activeFarms);}else{farmsStaked=farmsList(inactiveFarms);}farmsStaked=sortFarms(farmsStaked);var renderContent=function renderContent(){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(FlexLayout,{children:/*#__PURE__*/_jsx(Route,{exact:true,path:\"\".concat(path),children:farmsStaked.map(function(farm){return farm.pid!==3&&farm.pid!==4?/*#__PURE__*/_jsx(FarmCard,{farm:farm,bnbPrice:bnbPrice,cakePrice:cakePrice,ethPrice:ethPriceUsd,account:account,removed:false},farm.pid):/*#__PURE__*/_jsx(_Fragment,{});})})})});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Header,{children:[/*#__PURE__*/_jsx(Heading,{as:\"h1\",size:\"xxl\",color:\"secondary\",mb:\"24px\",children:TranslateString(999,'Farms')}),/*#__PURE__*/_jsx(Heading,{size:\"lg\",color:\"text\",children:TranslateString(999,'Stake Liquidity Pool (LP) tokens to earn.')})]}),/*#__PURE__*/_jsxs(Page,{children:[renderContent(),/*#__PURE__*/_jsx(StyledImage,{src:\"/images/3dpan.png\",alt:\"Pancake illustration\",width:120,height:103})]})]});};export default Farms;","map":{"version":3,"sources":["C:/Users/Matias/Downloads/svy final/SPreace-frontend/src/views/Farms/Farms.tsx"],"names":["React","useEffect","useCallback","useState","Route","useRouteMatch","useLocation","useDispatch","BigNumber","useWeb3React","Image","Heading","styled","BLOCKS_PER_YEAR","CAKE_PER_BLOCK","CAKE_POOL_PID","FlexLayout","Page","useFarms","usePriceBnbBusd","usePriceCakeBusd","usePriceEthBusd","useRefresh","fetchFarmUserDataAsync","QuoteToken","useI18n","orderBy","FarmCard","StyledImage","Header","div","theme","colors","gradients","bubblegum","mediaQueries","sm","Farms","path","pathname","TranslateString","farmsLP","cakePrice","bnbPrice","query","ethPriceUsd","account","sortOption","dispatch","fastRefresh","stackedOnly","activeFarms","filter","farm","pid","multiplier","inactiveFarms","stackedOnlyFarms","userData","stakedBalance","isGreaterThan","sortFarms","farms","Number","slice","earnings","liquidity","farmsList","farmsToDisplay","cakePriceVsBNB","find","tokenPriceVsQuote","farmsToDisplayWithAPY","map","tokenAmount","lpTotalInQuoteToken","cakeRewardPerBlock","times","poolWeight","cakeRewardPerYear","apy","quoteTokenSymbol","BUSD","UST","ETH","CAKE","dual","cakeApy","dualApy","rewardPerBlock","plus","BNB","lowercaseQuery","toLowerCase","lpSymbol","includes","isActive","farmsStaked","renderContent"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback, useState } from 'react'\r\nimport { Route, useRouteMatch, useLocation } from 'react-router-dom'\r\nimport { useDispatch } from 'react-redux'\r\nimport BigNumber from 'bignumber.js'\r\nimport { useWeb3React } from '@web3-react/core'\r\nimport { Image, Heading } from '@pancakeswap-libs/uikit'\r\nimport styled from 'styled-components'\r\nimport { BLOCKS_PER_YEAR, CAKE_PER_BLOCK, CAKE_POOL_PID } from 'config'\r\nimport FlexLayout from 'components/layout/Flex'\r\nimport Page from 'components/layout/Page'\r\nimport { useFarms, usePriceBnbBusd, usePriceCakeBusd, usePriceEthBusd } from 'state/hooks'\r\nimport useRefresh from 'hooks/useRefresh'\r\nimport { fetchFarmUserDataAsync } from 'state/actions'\r\nimport { QuoteToken } from 'config/constants/types'\r\nimport useI18n from 'hooks/useI18n'\r\nimport { orderBy } from 'lodash'\r\n\r\nimport FarmCard, { FarmWithStakedValue } from './components/FarmCard/FarmCard'\r\n\r\n\r\nconst StyledImage = styled(Image)`\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  margin-top: 58px;\r\n`\r\n\r\nconst Header = styled.div`\r\n  padding: 32px 0px;\r\n  background: ${({ theme }) => theme.colors.gradients.bubblegum};\r\n\r\n  padding-left: 16px;\r\n  padding-right: 16px;\r\n\r\n  ${({ theme }) => theme.mediaQueries.sm} {\r\n    padding-left: 24px;\r\n    padding-right: 24px;\r\n  }\r\n`\r\n\r\nconst Farms: React.FC = () => {\r\n  const { path } = useRouteMatch()\r\n  const { pathname } = useLocation()\r\n  const TranslateString = useI18n()\r\n  const farmsLP = useFarms()\r\n  const cakePrice = usePriceCakeBusd()\r\n  const bnbPrice = usePriceBnbBusd()\r\n  const [query ] = useState('')\r\n  const ethPriceUsd = usePriceEthBusd()\r\n  const { account } = useWeb3React()\r\n  const [sortOption ] = useState('hot')\r\n\r\n  const dispatch = useDispatch()\r\n  const { fastRefresh } = useRefresh()\r\n  useEffect(() => {\r\n    if (account) {\r\n      dispatch(fetchFarmUserDataAsync(account))\r\n    }\r\n  }, [account, dispatch, fastRefresh])\r\n\r\n  const [stackedOnly] = useState(false)\r\n\r\n  const activeFarms = farmsLP.filter((farm) => farm.pid !== 0 && farm.multiplier !== '0X')\r\n  const inactiveFarms = farmsLP.filter((farm) => farm.pid !== 0 && farm.multiplier === '0X')\r\n\r\n  const stackedOnlyFarms = activeFarms.filter(\r\n    (farm) => farm.userData && new BigNumber(farm.userData.stakedBalance).isGreaterThan(0),\r\n  )\r\n\r\n  const sortFarms = (farms: FarmWithStakedValue[]): FarmWithStakedValue[] => {\r\n    switch (sortOption) {\r\n      case 'apr':\r\n        return orderBy(farms, 'apy', 'desc')\r\n      case 'multiplier':\r\n        return orderBy(farms, (farm: FarmWithStakedValue) => Number(farm.multiplier.slice(0, -1)), 'desc')\r\n      case 'earned':\r\n        return orderBy(farms, (farm: FarmWithStakedValue) => (farm.userData ? farm.userData.earnings : 0), 'desc')\r\n      case 'liquidity':\r\n        return orderBy(farms, (farm: FarmWithStakedValue) => Number(farm.liquidity), 'desc')\r\n      default:\r\n        return farms\r\n    }\r\n  }\r\n\r\n  // /!\\ This function will be removed soon\r\n  // This function compute the APY for each farm and will be replaced when we have a reliable API\r\n  // to retrieve assets prices against USD\r\n  const farmsList = useCallback(\r\n    (farmsToDisplay): FarmWithStakedValue[] => {\r\n      const cakePriceVsBNB = new BigNumber(farmsLP.find((farm) => farm.pid === CAKE_POOL_PID)?.tokenPriceVsQuote || 0)\r\n      let farmsToDisplayWithAPY: FarmWithStakedValue[] = farmsToDisplay.map((farm) => {\r\n        if (!farm.tokenAmount || !farm.lpTotalInQuoteToken) {\r\n          return farm\r\n        }\r\n        const cakeRewardPerBlock = CAKE_PER_BLOCK.times(farm.poolWeight)\r\n        const cakeRewardPerYear = cakeRewardPerBlock.times(BLOCKS_PER_YEAR)\r\n\r\n        // cakePriceInQuote * cakeRewardPerYear / lpTotalInQuoteToken\r\n        let apy = cakePriceVsBNB.times(cakeRewardPerYear).div(farm.lpTotalInQuoteToken)\r\n\r\n        if (farm.quoteTokenSymbol === QuoteToken.BUSD || farm.quoteTokenSymbol === QuoteToken.UST) {\r\n          apy = cakePriceVsBNB.times(cakeRewardPerYear).div(farm.lpTotalInQuoteToken).times(bnbPrice)\r\n        } else if (farm.quoteTokenSymbol === QuoteToken.ETH) {\r\n          apy = cakePrice.div(ethPriceUsd).times(cakeRewardPerYear).div(farm.lpTotalInQuoteToken)\r\n        } else if (farm.quoteTokenSymbol === QuoteToken.CAKE) {\r\n          apy = cakeRewardPerYear.div(farm.lpTotalInQuoteToken)\r\n        } else if (farm.dual) {\r\n          const cakeApy =\r\n            farm && cakePriceVsBNB.times(cakeRewardPerBlock).times(BLOCKS_PER_YEAR).div(farm.lpTotalInQuoteToken)\r\n          const dualApy =\r\n            farm.tokenPriceVsQuote &&\r\n            new BigNumber(farm.tokenPriceVsQuote)\r\n              .times(farm.dual.rewardPerBlock)\r\n              .times(BLOCKS_PER_YEAR)\r\n              .div(farm.lpTotalInQuoteToken)\r\n\r\n          apy = cakeApy && dualApy && cakeApy.plus(dualApy)\r\n        }\r\n\r\n        let liquidity = farm.lpTotalInQuoteToken\r\n\r\n        if (!farm.lpTotalInQuoteToken) {\r\n          liquidity = null\r\n        }\r\n        if (farm.quoteTokenSymbol === QuoteToken.BNB) {\r\n          liquidity = bnbPrice.times(farm.lpTotalInQuoteToken)\r\n        }\r\n        if (farm.quoteTokenSymbol === QuoteToken.CAKE) {\r\n          liquidity = cakePrice.times(farm.lpTotalInQuoteToken)\r\n        }\r\n\r\n        if (farm.quoteTokenSymbol === QuoteToken.ETH) {\r\n          liquidity = ethPriceUsd.times(farm.lpTotalInQuoteToken)\r\n        }\r\n\r\n        return { ...farm, apy, liquidity }\r\n      })\r\n\r\n      if (query) {\r\n        const lowercaseQuery = query.toLowerCase()\r\n        farmsToDisplayWithAPY = farmsToDisplayWithAPY.filter((farm: FarmWithStakedValue) => {\r\n          if (farm.lpSymbol.toLowerCase().includes(lowercaseQuery)) {\r\n            return true\r\n          }\r\n\r\n          return false\r\n        })\r\n      }\r\n      return farmsToDisplayWithAPY\r\n    },\r\n    [bnbPrice, farmsLP, query, cakePrice, ethPriceUsd],\r\n  )\r\n\r\n  const isActive = !pathname.includes('history')\r\n  let farmsStaked = []\r\n  if (isActive) {\r\n    farmsStaked = stackedOnly ? farmsList(stackedOnlyFarms) : farmsList(activeFarms)\r\n  } else {\r\n    farmsStaked = farmsList(inactiveFarms)\r\n  }\r\n\r\n  farmsStaked = sortFarms(farmsStaked)\r\n\r\n\r\n  const renderContent = (): JSX.Element => {\r\n\r\n    return (\r\n      <div>\r\n        <FlexLayout>\r\n          <Route exact path={`${path}`}>\r\n            {farmsStaked.map((farm) => (farm.pid !== 3 && farm.pid !== 4 ?\r\n              <FarmCard\r\n                key={farm.pid}\r\n                farm={farm}\r\n                bnbPrice={bnbPrice}\r\n                cakePrice={cakePrice}\r\n                ethPrice={ethPriceUsd}\r\n                account={account}\r\n                removed={false}\r\n              />:<></>\r\n            ))}\r\n          </Route>\r\n        </FlexLayout>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Header>\r\n        <Heading as=\"h1\" size=\"xxl\" color=\"secondary\" mb=\"24px\">\r\n          {TranslateString(999, 'Farms')}\r\n        </Heading>\r\n        <Heading size=\"lg\" color=\"text\">\r\n          {TranslateString(999, 'Stake Liquidity Pool (LP) tokens to earn.')}\r\n        </Heading>\r\n      </Header>\r\n      <Page>\r\n        \r\n        {renderContent()}\r\n        <StyledImage src=\"/images/3dpan.png\" alt=\"Pancake illustration\" width={120} height={103} />\r\n      </Page>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Farms\r\n"]},"metadata":{},"sourceType":"module"}