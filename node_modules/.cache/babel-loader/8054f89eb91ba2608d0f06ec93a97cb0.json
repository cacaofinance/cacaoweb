{"ast":null,"code":"import merge from 'lodash/merge';\nimport teamsList from 'config/constants/teams';\nimport { getProfileContract } from 'utils/contractHelpers';\nimport makeBatchRequest from 'utils/makeBatchRequest';\nconst profileContract = getProfileContract();\nexport const getTeam = async teamId => {\n  try {\n    const {\n      0: teamName,\n      2: numberUsers,\n      3: numberPoints,\n      4: isJoinable\n    } = await profileContract.methods.getTeamProfile(teamId).call();\n    const staticTeamInfo = teamsList.find(staticTeam => staticTeam.id === teamId);\n    return merge({}, staticTeamInfo, {\n      isJoinable,\n      name: teamName,\n      users: numberUsers,\n      points: numberPoints\n    });\n  } catch (error) {\n    return null;\n  }\n};\n/**\r\n * Gets on-chain data and merges it with the existing static list of teams\r\n */\n\nexport const getTeams = async () => {\n  try {\n    const teamsById = teamsList.reduce((accum, team) => {\n      return { ...accum,\n        [team.id]: team\n      };\n    }, {});\n    const nbTeams = await profileContract.methods.numberTeams().call();\n    const calls = [];\n\n    for (let i = 1; i <= nbTeams; i++) {\n      calls.push(profileContract.methods.getTeamProfile(i).call);\n    }\n\n    const teamData = await makeBatchRequest(calls);\n    const onChainTeamData = teamData.reduce((accum, team, index) => {\n      const {\n        0: teamName,\n        2: numberUsers,\n        3: numberPoints,\n        4: isJoinable\n      } = team;\n      return { ...accum,\n        [index + 1]: {\n          name: teamName,\n          users: Number(numberUsers),\n          points: Number(numberPoints),\n          isJoinable\n        }\n      };\n    }, {});\n    return merge({}, teamsById, onChainTeamData);\n  } catch (error) {\n    return null;\n  }\n};","map":{"version":3,"sources":["C:/PROYECTOS/SVY/svy final/Sviolence-frontend/src/state/teams/helpers.ts"],"names":["merge","teamsList","getProfileContract","makeBatchRequest","profileContract","getTeam","teamId","teamName","numberUsers","numberPoints","isJoinable","methods","getTeamProfile","call","staticTeamInfo","find","staticTeam","id","name","users","points","error","getTeams","teamsById","reduce","accum","team","nbTeams","numberTeams","calls","i","push","teamData","onChainTeamData","index","Number"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,cAAlB;AACA,OAAOC,SAAP,MAAsB,wBAAtB;AACA,SAASC,kBAAT,QAAmC,uBAAnC;AAEA,OAAOC,gBAAP,MAA6B,wBAA7B;AAGA,MAAMC,eAAe,GAAGF,kBAAkB,EAA1C;AAEA,OAAO,MAAMG,OAAO,GAAG,MAAOC,MAAP,IAAyC;AAC9D,MAAI;AACF,UAAM;AACJ,SAAGC,QADC;AAEJ,SAAGC,WAFC;AAGJ,SAAGC,YAHC;AAIJ,SAAGC;AAJC,QAKF,MAAMN,eAAe,CAACO,OAAhB,CAAwBC,cAAxB,CAAuCN,MAAvC,EAA+CO,IAA/C,EALV;AAMA,UAAMC,cAAc,GAAGb,SAAS,CAACc,IAAV,CAAgBC,UAAD,IAAgBA,UAAU,CAACC,EAAX,KAAkBX,MAAjD,CAAvB;AAEA,WAAON,KAAK,CAAC,EAAD,EAAKc,cAAL,EAAqB;AAC/BJ,MAAAA,UAD+B;AAE/BQ,MAAAA,IAAI,EAAEX,QAFyB;AAG/BY,MAAAA,KAAK,EAAEX,WAHwB;AAI/BY,MAAAA,MAAM,EAAEX;AAJuB,KAArB,CAAZ;AAMD,GAfD,CAeE,OAAOY,KAAP,EAAc;AACd,WAAO,IAAP;AACD;AACF,CAnBM;AAqBP;AACA;AACA;;AACA,OAAO,MAAMC,QAAQ,GAAG,YAAgC;AACtD,MAAI;AACF,UAAMC,SAAS,GAAGtB,SAAS,CAACuB,MAAV,CAAiB,CAACC,KAAD,EAAQC,IAAR,KAAiB;AAClD,aAAO,EACL,GAAGD,KADE;AAEL,SAACC,IAAI,CAACT,EAAN,GAAWS;AAFN,OAAP;AAID,KALiB,EAKf,EALe,CAAlB;AAMA,UAAMC,OAAO,GAAG,MAAMvB,eAAe,CAACO,OAAhB,CAAwBiB,WAAxB,GAAsCf,IAAtC,EAAtB;AACA,UAAMgB,KAAK,GAAG,EAAd;;AAEA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAIH,OAArB,EAA8BG,CAAC,EAA/B,EAAmC;AACjCD,MAAAA,KAAK,CAACE,IAAN,CAAW3B,eAAe,CAACO,OAAhB,CAAwBC,cAAxB,CAAuCkB,CAAvC,EAA0CjB,IAArD;AACD;;AAED,UAAMmB,QAAQ,GAAI,MAAM7B,gBAAgB,CAAC0B,KAAD,CAAxC;AACA,UAAMI,eAAe,GAAGD,QAAQ,CAACR,MAAT,CAAgB,CAACC,KAAD,EAAQC,IAAR,EAAcQ,KAAd,KAAwB;AAC9D,YAAM;AAAE,WAAG3B,QAAL;AAAe,WAAGC,WAAlB;AAA+B,WAAGC,YAAlC;AAAgD,WAAGC;AAAnD,UAAkEgB,IAAxE;AAEA,aAAO,EACL,GAAGD,KADE;AAEL,SAACS,KAAK,GAAG,CAAT,GAAa;AACXhB,UAAAA,IAAI,EAAEX,QADK;AAEXY,UAAAA,KAAK,EAAEgB,MAAM,CAAC3B,WAAD,CAFF;AAGXY,UAAAA,MAAM,EAAEe,MAAM,CAAC1B,YAAD,CAHH;AAIXC,UAAAA;AAJW;AAFR,OAAP;AASD,KAZuB,EAYrB,EAZqB,CAAxB;AAcA,WAAOV,KAAK,CAAC,EAAD,EAAKuB,SAAL,EAAgBU,eAAhB,CAAZ;AACD,GA9BD,CA8BE,OAAOZ,KAAP,EAAc;AACd,WAAO,IAAP;AACD;AACF,CAlCM","sourcesContent":["import merge from 'lodash/merge'\r\nimport teamsList from 'config/constants/teams'\r\nimport { getProfileContract } from 'utils/contractHelpers'\r\nimport { Team } from 'config/constants/types'\r\nimport makeBatchRequest from 'utils/makeBatchRequest'\r\nimport { TeamsById, TeamResponse } from 'state/types'\r\n\r\nconst profileContract = getProfileContract()\r\n\r\nexport const getTeam = async (teamId: number): Promise<Team> => {\r\n  try {\r\n    const {\r\n      0: teamName,\r\n      2: numberUsers,\r\n      3: numberPoints,\r\n      4: isJoinable,\r\n    } = await profileContract.methods.getTeamProfile(teamId).call()\r\n    const staticTeamInfo = teamsList.find((staticTeam) => staticTeam.id === teamId)\r\n\r\n    return merge({}, staticTeamInfo, {\r\n      isJoinable,\r\n      name: teamName,\r\n      users: numberUsers,\r\n      points: numberPoints,\r\n    })\r\n  } catch (error) {\r\n    return null\r\n  }\r\n}\r\n\r\n/**\r\n * Gets on-chain data and merges it with the existing static list of teams\r\n */\r\nexport const getTeams = async (): Promise<TeamsById> => {\r\n  try {\r\n    const teamsById = teamsList.reduce((accum, team) => {\r\n      return {\r\n        ...accum,\r\n        [team.id]: team,\r\n      }\r\n    }, {})\r\n    const nbTeams = await profileContract.methods.numberTeams().call()\r\n    const calls = []\r\n\r\n    for (let i = 1; i <= nbTeams; i++) {\r\n      calls.push(profileContract.methods.getTeamProfile(i).call)\r\n    }\r\n\r\n    const teamData = (await makeBatchRequest(calls)) as TeamResponse[]\r\n    const onChainTeamData = teamData.reduce((accum, team, index) => {\r\n      const { 0: teamName, 2: numberUsers, 3: numberPoints, 4: isJoinable } = team\r\n\r\n      return {\r\n        ...accum,\r\n        [index + 1]: {\r\n          name: teamName,\r\n          users: Number(numberUsers),\r\n          points: Number(numberPoints),\r\n          isJoinable,\r\n        },\r\n      }\r\n    }, {})\r\n\r\n    return merge({}, teamsById, onChainTeamData)\r\n  } catch (error) {\r\n    return null\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}